![image-20210618161125894](http://mdrs.yuanjin.tech/img/20210618161125.png)

# catch æ–¹æ³•

`.catch(onRejected)` = `.then(null, onRejected)`

# é“¾å¼è°ƒç”¨

![image-20210621103501094](http://mdrs.yuanjin.tech/img/20210621103501.png)

1. then æ–¹æ³•å¿…å®šä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise

   å¯ç†è§£ä¸º`åç»­å¤„ç†çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡`

2. æ–°ä»»åŠ¡çš„çŠ¶æ€å–å†³äºä¹‹å‰ä»»åŠ¡åç»­å¤„ç†ï¼š

   - è‹¥æ²¡æœ‰ç›¸å…³çš„åç»­å¤„ç†ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€å’Œå‰ä»»åŠ¡ä¸€è‡´ï¼Œæ•°æ®ä¸ºå‰ä»»åŠ¡çš„æ•°æ®

     - ç›¸å…³çš„åç»­å¤„ç†æŒ‡ï¼šå¦‚æœå‰ä¸€ä¸ªä»»åŠ¡æ˜¯ resolveï¼Œæ˜¯æˆåŠŸçš„ï¼Œå¹¶ä¸”æœ‰æ‰§è¡Œ .then çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æˆåŠŸå’ŒæˆåŠŸç›¸å…³ã€‚å¦‚æœæ²¡æœ‰å¯¹æˆåŠŸå¤„ç†ï¼Œåªæ‰§è¡Œäº† .catch, æˆ–è€…æ˜¯ .then çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯´æ˜åªå¤„ç†äº†å¤±è´¥çš„æƒ…å†µï¼Œæ²¡æœ‰å¤„ç†æˆåŠŸçš„æƒ…å†µï¼Œå°±æ˜¯ä¸ç›¸å…³çš„åç»­å¤„ç†ã€‚

     ```js
     const pro1 = new Promise((resolve, reject) => {
       reject(1); // pro1 çš„çŠ¶æ€æ˜¯æ‹’ç»
     });
     
     // pro1 å¹¶æ²¡æœ‰å¯¹æ‹’ç»çŠ¶æ€åšåç»­å¤„ç†
     // æ‰€ä»¥ pro2 ä¹Ÿæ˜¯å¤±è´¥çŠ¶æ€ï¼Œ
     // pro2.thençš„ç¬¬äºŒä¸ªå‚æ•°æ‰§è¡Œï¼Œæ¥æ”¶åˆ°çš„å‚æ•°æ˜¯1
     const pro2 = pro1.then(() => {
       console.log("pro1 æˆåŠŸçŠ¶æ€çš„åç»­å¤„ç†");
     });
     
     pro2.then(
       () => {},
       (error) => {
         console.log(error); // 1
       }
     );
     
     // å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡(æŒ‡pro3)æˆåŠŸäº†ï¼Œä½†æ˜¯åªå¯¹å‰ä¸€ä¸ªä»»åŠ¡è¿›è¡Œå¤±è´¥å¤„ç†
     const pro3 = new Promise((resolve, reject) => {
       resolve(1);
     });
     
     // pro4 ä¹Ÿæ˜¯æˆåŠŸçŠ¶æ€
     const pro4 = pro3.catch(() => {
       console.log("å¤±è´¥äº†");
     });
     
     pro4.then((res) => {
       console.log(res); // 1
     });
     ```

     

   

   - è‹¥æœ‰åç»­å¤„ç†ä½†è¿˜æœªæ‰§è¡Œï¼Œæ–°ä»»åŠ¡æŒ‚èµ·ã€‚

     ```js
     const pro1 = new Promise((resolve, reject) => {
       console.log("å­¦ä¹ ");
       setTimeout(() => {
         resolve();
       }, 2000);
     });
     
     // pro2 æ˜¯ä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œ å¹¶ä¸”pro1å¯¹æˆåŠŸè¿›è¡Œäº†å¤„ç†
     // ä½†æ˜¯å› ä¸º pro1 åœ¨ 2s ä¹‹åçŠ¶æ€æ‰ä¼šå‘ç”Ÿæ”¹å˜
     // åœ¨pro1 çŠ¶æ€æ”¹å˜ä¹‹å‰ï¼Œpro2 ä¸€ç›´æ˜¯ pendingï¼Œ
     const pro2 = pro1.then(() => {
       console.log("è€ƒè¯•");
     });
     ```

     

   - è‹¥åç»­å¤„ç†æ‰§è¡Œäº†ï¼Œåˆ™æ ¹æ®åç»­å¤„ç†çš„æƒ…å†µç¡®å®šæ–°ä»»åŠ¡çš„çŠ¶æ€
     - åç»­å¤„ç†æ‰§è¡Œæ— é”™ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€ä¸ºå®Œæˆï¼Œæ•°æ®ä¸ºåç»­å¤„ç†çš„è¿”å›å€¼

       ```js
       new Promise((resolve, reject) => {
         reslove();
       })
         .then(() => {
           // è¿™ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼
           console.log("success");
         })
         .then((res) => {
           console.log(res); // undefined
       
           // è¿™ä¸ªå‡½æ•°æœ‰è¿”å›å€¼
           return 1;
         })
         .then((res) => {
           console.log(res); // 1.
         });
       ```

       

     - åç»­å¤„ç†æ‰§è¡Œæœ‰é”™ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€ä¸ºå¤±è´¥ï¼Œæ•°æ®ä¸ºå¼‚å¸¸å¯¹è±¡

       ```js
       const pro = new Promise((resolve, reject) => {
         reslove();
       })
         .then(() => {
           // è¿™ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼
           console.log("success");
       
           throw new Error("ç¡ç€äº†ï¼ï¼ï¼");
         })
         .catch((error) => {
           console.log(error); // Error: ç¡ç€äº†ï¼ï¼sï¼
         });
       
       setTimeout(() => {
         console.log(pro); // resolved å› ä¸º å¤±è´¥è¢«å¤„ç†äº†ï¼Œå¹¶ä¸”å¤„ç†çš„è¿‡ç¨‹æ²¡æœ‰æŠ¥è¿‡ï¼Œæ‰€ä»¥è¿”å›çš„æ–°ä»»åŠ¡æ˜¯æˆåŠŸçš„ã€‚
       }, 2000);
       
       pro.then((res) => {
         console.log(res); // undefined å› ä¸º .catch è¿”å›å€¼æ˜¯undefined
       });
       
       const pro2 = new Promise((resolve, reject) => {
         reject();
       }).catch(() => {
         console.log("å¤„ç†é”™è¯¯");
         throw 123; // æŠ›å‡ºäº†ä¸€ä¸ªæ–°çš„é”™è¯¯
       });
       
       const pro3 = pro2.catch((error) => {
         console.log(error); // 123
         return 456;
       });
       
       setTimeout(() => {
         console.log(pro2); // Promise { <rejected> 123 }
         console.log(pro3); // Promise { 456 } æ²¡æœ‰çŠ¶æ€ï¼Œå°±æ˜¯æˆåŠŸçš„æ„æ€
       }, 2000);
       ```

       

     - åç»­æ‰§è¡Œåè¿”å›çš„æ˜¯ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€å’Œæ•°æ®ä¸è¯¥ä»»åŠ¡å¯¹è±¡ä¸€è‡´

       ```js
       const pro = new Promise((res) => {});
       
       const pro2 = new Promise((res) => {
         res();
       }).then(() => {
         return pro;
       });
       // pro2 çš„çŠ¶æ€å’Œ pro çš„çŠ¶æ€ä¸€æ ·ã€‚
       // pro æ˜¯ pendingï¼Œpro2å°±æ˜¯pending
       // pro æˆåŠŸï¼Œpro2 å°±æˆåŠŸ
       
       new Promise((res) => {
         res();
       })
         .then(() => {
           return new Promise((res) => {
             res(1);
           });
         })
         .then((res) => {
           console.log(res); // 1
         });
       ```



ç”±äºé“¾å¼ä»»åŠ¡çš„å­˜åœ¨ï¼Œå¼‚æ­¥ä»£ç æ‹¥æœ‰äº†æ›´å¼ºçš„è¡¨è¾¾åŠ›

```js
// å¸¸è§ä»»åŠ¡å¤„ç†ä»£ç 

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œæ‰§è¡Œå¤„ç†1ï¼Œå¤±è´¥åˆ™æ‰§è¡Œå¤„ç†2
 */
pro.then(å¤„ç†1).catch(å¤„ç†2);

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œä¾æ¬¡æ‰§è¡Œå¤„ç†1ã€å¤„ç†2
 */
pro.then(å¤„ç†1).then(å¤„ç†2);

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œä¾æ¬¡æ‰§è¡Œå¤„ç†1ã€å¤„ç†2ï¼Œè‹¥ä»»åŠ¡å¤±è´¥æˆ–å‰é¢çš„å¤„ç†æœ‰é”™ï¼Œæ‰§è¡Œå¤„ç†3
 */
pro.then(å¤„ç†1).then(å¤„ç†2).catch(å¤„ç†3);
```

# é‚“å“¥çš„è§£å†³æ–¹æ¡ˆ

```js
// å‘æŸä½å¥³ç”Ÿå‘é€ä¸€åˆ™è¡¨ç™½çŸ­ä¿¡
// name: å¥³ç¥çš„å§“å
// onFulffiled: æˆåŠŸåçš„å›è°ƒ
// onRejected: å¤±è´¥åçš„å›è°ƒ
function sendMessage(name) {
  return new Promise((resolve, reject) => {
    // æ¨¡æ‹Ÿ å‘é€è¡¨ç™½çŸ­ä¿¡
    console.log(
      `é‚“å“¥ -> ${name}ï¼šæœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ğŸ˜˜`
    );
    console.log(`ç­‰å¾…${name}å›å¤......`);
    // æ¨¡æ‹Ÿ å¥³ç¥å›å¤éœ€è¦ä¸€æ®µæ—¶é—´
    setTimeout(() => {
      // æ¨¡æ‹Ÿ æœ‰10%çš„å‡ ç‡æˆåŠŸ
      if (Math.random() <= 0.1) {
        // æˆåŠŸï¼Œè°ƒç”¨ onFuffiledï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        resolve(`${name} -> é‚“å“¥ï¼šæˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ğŸ˜˜`);
      } else {
        // å¤±è´¥ï¼Œè°ƒç”¨ onRejectedï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        reject(`${name} -> é‚“å“¥ï¼šä½ æ˜¯ä¸ªå¥½äººğŸ˜œ`);
      }
    }, 1000);
  });
}

sendMessage("æå»ºå›½")
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage("ç‹å¯Œè´µ");
  })
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage("å‘¨èšè´¢");
  })
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage("åˆ˜äººå‹‡");
  })
  .then(
    (reply) => {
      // æˆåŠŸï¼Œç»“æŸ
      console.log(reply);
      console.log("é‚“å“¥ç»ˆäºæ‰¾åˆ°äº†è‡ªå·±çš„ä¼´ä¾£");
    },
    (reply) => {
      // æœ€åä¸€ä¸ªä¹Ÿå¤±è´¥äº†
      console.log(reply);
      console.log("é‚“å“¥å‘½çŠ¯å¤©ç…å­¤æ˜Ÿï¼Œæ— ä¼´ç»ˆè€ï¼Œå­¤ç‹¬ä¸€ç”Ÿ");
    }
  );
```
